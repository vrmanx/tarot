
#质量管理中生产力工具的使用

　　软件开发质量管理中最重要的事情之一就是生产力工具的使用。所谓工欲善其事、必先利其器。质量管理的核心目标，是为了降低缺陷成本，提高效率，切忌单纯的为了质量管理而质量管理，严重影响程序员的开发效率，不但容易招致抵触情绪很难推行，更重要的是“舍本逐末、得不偿失”。一旦质量管理的工具好用，随着大家工作效率提高、缺陷减少，吃到“甜头”，学到了关于代码质量的技巧和知识，养成了编程习惯，那么质量管理的团队文化就自然而然的形成了，质量管理也就成功了一大半。
 

##善用静态代码检查工具

　　静态代码检查工具的主要作用有4个：
•尽可能早的发现代码中的潜在缺陷（编码时）
•减少不必要争议，建立统一代码规范和标准
•培养良好的编程习惯
•积累基础的编程技巧和知识，提高团队水平

　　.NET里面常用的静态代码检查工具的主要有三个：
•FxCop（也即Visual Studio系列内置的工具，也有独立安装的版本）
•Resharper（比前两者更详细和全面，而内建重构工具）
•StyleCop（侧重检查代码风格、注释、拼写之类的）

　　使用静态代码检查工具时的一些注意事项：
•FxCop
◦完全免费内嵌到VS2013中（其它就版本的VS也有），也有相对较旧的一个standalone的版本可以命令行界面用。
◦默认情况下，所有的代码都必须通过FxCop的全部规则的审查（例外只能在代码中Suppress，而且需要Justification），一般不允许为整个工程甚至整个解决方案Disable规则。
◦每次本地编译和团队构建时，都会强制检查FxCop，一旦发现违背规则会让代码编译不通过，且无法提交成功。
◦为提高项目编译的速度，对Debug版我们通常用相对较少的默认的推荐规则，而对Release版则用全部规则；此外，对测试代码我们也会酌情使用默认的推荐规则而非全部规则。
•Resharper
◦一个商业化的软件，需要付费购买，但功能强、方便而且效果立竿见影 
◦默认情况下，鼓励所有代码都必须通过Resharper的全部规则的审查，但除个别要求较严的团队外一般不做硬性要求，也不集成到build中 
◦为统一代码风格，一般不鼓励对规则做定制和批量的Disable，可搭配StyleCop一起使用。
•StyleCop/GhostDoc
◦StyleCop一个免费软件，对统一代码风格特别是注释的质量是非常有帮助的。GhostDoc是商业软件，但有免费版，可以用来提高代码注释书写的效率 
◦默认情况下，鼓励所有代码通过StyleCop的审查，而且Resharper和StyleCop配合得很好，但除个别要求较严的团队外一般不做硬性要求，也不集成到build中。 

　　几点善意的提醒：
•这些编程规则都是多年社区血泪经验的结晶，就算你是编程的老手，如果以前没真正学习和研究过，恐怕也不见得能写出漂亮的通过静态代码检查的代码，尤其是年轻气盛的管理者和当权者，切勿因为自己的无知而随意定制化规则，而放弃了一个提高质量和共同学习的大好机会。
•一个项目如果想用这些工具，那么最好从第一天就用，不要代码写了一多半再开始。那样的话，数千个代码缺陷扑面而来，可能会让某些人产生一些“走捷径”的非常错误的想法和做法。
•对于一些老旧项目，特别已经在生产环境中被部署和使用的产品来说，如果想使用这些静态代码检查工具，就更需要谨慎并有计划：首先，要优先重构最核心的代码；其次，所有被重构的代码都应该有充分的单元测试；第三，可以将规则分批逐步的Enable，特别是FxCop，不要试图一蹴而就。


##重视代码评审

　　代码评审工具的主要作用有3个：
•尽可能早的发现代码的缺陷（代码提交前）
•从另一个人的视角来看代码，避免开发者的思维局限性
•除主要评审员外，整个团队实际上都可以看到和参与代码的评审，通过讨论和沟通，增进技术和知识的团队分享

　　因为公司里有好几套非常强大的内部代码评审工具，所以对其它外部的代码评审工具不甚了解，暂无什么可以推荐的。不过一个好的代码评审工具应该支持以下功能：
•方便的代码对比工具。
•团队可见（通过内部邮件和社交网络，让大家可以及时的了解和参与代码评审中的讨论）
•支持多版本的Iteration。也就是开发者可以根据前面的评审者的Feedback形成新的代码版本重新Review
•支持缺陷追踪。
质量管理中生产力工具的使用

　　使用代码评审工具时的一些注意事项：
•评审者与开发者是平等的，不要过度提倡和采用管理和被管理的形式，这样容易产生知识和技术的误导。所谓真理不辨不明，技术管理者应该多充当观察者和仲裁者，在行使决定权之前让大家充分的讨论。
•整个团队应该一起构建一个checklist，告诉大家评审人员应该检查哪些方面，按图索骥避免遗漏。
•评审中如果出现一些特别多的小的技术缺陷和争议，可能会降低大家的工作效率。应考虑采用以下措施：
◦如果是非关键问题，可以先将缺陷记录为Issue，并留待后续的其他check-in来处理。 
◦如果是一个比较关键的有争议的问题，可以先将这部分代码剔除，先将其它部分的代码评审通过并签入。


##持续集成、团队构建与测试自动化

　　持续集成并在团队构建（Team Build）中集成自动化的测试是非常有效的提高代码质量的方式。持续集成的Team Build主要分为三种，一个比较大的项目可能会全部采用。
•Gated Build：TFS支持在每次代码提交前自动运行Team Build并进行测试，测试失败的话签入无效。
•Rolling Build：TFS支持在代码提交完成后，把为一段时间以内的所有代码变化一起生成一个新的Team Build并进行测试。
•Daily Build：TFS支持每天在固定的时间生成Team Build并进行测试。

　　因为对于大的项目来说，在Team Build中运行测试是非常耗时的。为了提高大家的工作效率，需要合理的安排三种Team Build的运行测试的种类。
•Gated Build：运行核心组件的重要功能测试和全部单元测试。
•Rolling Build：运行全部组件的功能测试，有条件的话，可运行一部分基础的E2E集成测试。
•Daily Build：运行全部测试，包括功能测试、单元测试和集成测试。有一些团队还会集成一些自动化的性能测试、安全测试等。 

　　一些关于单元测试的技巧：
•单元测试应该写得短小精悍，运行起来很快且可以并行、彼此独立的执行。
•普及Mock类测试框架，降低单元测试内模拟各种测试场景的难度。.NET程序员中比较著名的Mock框架名字叫Moq。
•单元测试的代码覆盖率应控制不低于60-80%。核心业务逻辑应追求更高的代码覆盖率。
•避免提交无法被单元测试的代码。每次发现和修正Bug的时候，考虑增加相应的单元测试来覆盖出错的场景。

##重大缺陷的管理
　　对于那些已经部署到生产环境后发现的质量缺陷，特别那些对关键业务产生不利影响的缺陷，需要重点和专门管理。一些常见的做法如下：
•开发人员：技术上是否有不足，流程的执行上是否有疏忽，单元测试是否充分，设计是否合理，对需求理解是否准确
•评审人员：技术上是否有不足，评审的checklist时是否有盲点，流程的执行上是否有疏忽
•测试人员：集成测试的案例是否充分、合理
•管理人员：流程的执行上是否需要加强监督，流程本身是否有盲点，知识管理是否可以改进
•运维人员：类似情形发生时，如何更快定位问题和止损

　　对重大缺陷的管理需要注意以下四点：
•坚持对缺陷的零容忍，每个缺陷必须从自己身上找到原因并找出解决之道，不能鼓励推诿，要积极的从自己身上找原因 
•重点关注如何避免类似缺陷再次发生。重复自己和别人错误要和个人绩效、团队绩效挂钩。
•避免破坏团队团结的情形发生
•注意保护个人积极性，不要变成批斗大会


##缺陷调试的效率

　　质量管理过程中，必须进一步提高缺陷调试的效率，主要手段有3个：
•日志：一套完备的应用服务日志常常可以把定位错误的效率提高数倍。
◦一些团队会用专门的日志分析工具，通过定期的日志分析发现一些潜在问题
◦一些团队会用专门的工具监视服务日志，针对一些情况发出自动的警报，力图在第一时间发现问题
◦记录太多的日志可能严重影响性能并干扰代码的阅读，不要过度使用
•性能计数器：性能计数器非常适合诊断与性能和稳定性相关的问题。
◦一些团队会利用专门的工具监视性能计数器，针对一些情况发出自动的警报，力图在第一时间发现问题
◦错误的编码方式和引入太多的性能计数器有可能可能影响性能并干扰代码的阅读，不要过度使用
•在线诊断：对网络服务（客户端应用也可以），内嵌的在线调试接口可以在Repro错误的同时给出大量诊断信息。
◦对于满足特定条件的请求，服务程序的在线诊断模块会提供一个标准化的诊断上下文，将请求处理过程中的详细执行情况作为诊断信息记录下来以供调试 
◦这样可以避免对生产环境的业务及其性能产生影响，也可避免为了调试而部署新的版本。


